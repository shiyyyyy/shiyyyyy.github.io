{"title":"小程序-日历","slug":"小程序-日历","date":"2018-03-11T06:18:11.000Z","updated":"2018-03-11T07:06:06.510Z","comments":true,"path":"api/articles/小程序-日历.json","photos":[],"link":"","excerpt":null,"covers":null,"content":"<p>最近开发小程序的时候,需要做一个日历,所以就自己开发了一个小程序日历控件。大家要是不想自己费时间来写的话，可以用这个。<br>(请注意,这个是不带一些节日的!因为我当时的需求不需要节日)</p>\n<p>不废话,直接上干货</p>\n<p>WXML可以去掉一些你不需要的东西,比如 WXS 就可以去掉,我是用它处理返回字符串格式的问题的。<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!-- WXML --&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;view <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">\"calendar\"</span> bindtap=<span class=\"string\">'tap'</span>&gt;</span><br><span class=\"line\">  &lt;view <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">\"calendar-panel\"</span> bindtap=<span class=\"string\">\"changeMonth\"</span>&gt;</span><br><span class=\"line\">    &lt;view <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">\"prevImg\"</span>&gt;</span><br><span class=\"line\">      &lt;image src=<span class=\"string\">\"../../images/icon/next.png\"</span> data-name=<span class=\"string\">\"prev\"</span> /&gt;</span><br><span class=\"line\">    &lt;<span class=\"regexp\">/view&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">    &lt;view class=\"time\"&gt;&#123;&#123;calendar.year&#125;&#125;年&#123;&#123;calendar.month&#125;&#125;月&#123;&#123;calendar.date&#125;&#125;日&lt;/</span>view&gt;</span><br><span class=\"line\">    &lt;view <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">\"nextImg\"</span>&gt;</span><br><span class=\"line\">      &lt;image src=<span class=\"string\">\"../../images/icon/next.png\"</span> data-name=<span class=\"string\">\"next\"</span> /&gt;</span><br><span class=\"line\">    &lt;<span class=\"regexp\">/view&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">  &lt;/</span>view&gt;</span><br><span class=\"line\">  &lt;view <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">\"calendar-header\"</span>&gt;</span><br><span class=\"line\">    &lt;view&gt;日&lt;<span class=\"regexp\">/view&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">    &lt;view&gt;一&lt;/</span>view&gt;</span><br><span class=\"line\">    &lt;view&gt;二&lt;<span class=\"regexp\">/view&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">    &lt;view&gt;三&lt;/</span>view&gt;</span><br><span class=\"line\">    &lt;view&gt;四&lt;<span class=\"regexp\">/view&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">    &lt;view&gt;五&lt;/</span>view&gt;</span><br><span class=\"line\">    &lt;view&gt;六&lt;<span class=\"regexp\">/view&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">  &lt;/</span>view&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">  &lt;wxs <span class=\"built_in\">module</span>=<span class=\"string\">\"split\"</span>&gt;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">split</span>(<span class=\"params\">data</span>)</span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> newData = data.split(<span class=\"string\">\".\"</span>)</span><br><span class=\"line\">      <span class=\"keyword\">return</span> newData[<span class=\"number\">0</span>]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">module</span>.exports.split = split</span><br><span class=\"line\">  &lt;<span class=\"regexp\">/wxs&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">  &lt;view class=\"calendar-body\"&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">    &lt;block wx:for=\"&#123;&#123;calendar.weeks&#125;&#125;\" wx:for-item=\"weeks\"&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">      &lt;view class=\"calender-body-date-week\"&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">        &lt;block wx:for=\"&#123;&#123;weeks&#125;&#125;\" wx:for-item=\"day\"&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">          &lt;view class=\"date &#123;&#123;calendar.month == day.month? '' : 'other-month'&#125;&#125; &#123;&#123;day.date==calendar.date &amp;&amp; day.month  == active ?'avtive-date': ''&#125;&#125;\"&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">            &lt;view class=\"day\"&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">              &#123;&#123;day.date&#125;&#125;</span></span><br><span class=\"line\"><span class=\"regexp\">            &lt;/</span>view&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">            &lt;view <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">\"stage\"</span> wx:<span class=\"keyword\">for</span>=<span class=\"string\">\"&#123;&#123; moneyCalendar &#125;&#125;\"</span> wx:<span class=\"keyword\">if</span>=<span class=\"string\">\"&#123;&#123;item.date == day.date &amp;&amp; item.month == day.month&#125; &#125;\"</span> bindtap=<span class=\"string\">\"selectDay\"</span> data-activeDay=<span class=\"string\">\"&#123;&#123;day&#125;&#125;\"</span> data-idn=<span class=\"string\">\"&#123;&#123;index&#125;&#125;\"</span>&gt;</span><br><span class=\"line\">               ￥&#123;&#123; split.split( res[index].peer_price) &#125;&#125; </span><br><span class=\"line\">            &lt;<span class=\"regexp\">/view&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">          &lt;/</span>view&gt;</span><br><span class=\"line\">        &lt;<span class=\"regexp\">/block&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">      &lt;/</span>view&gt;</span><br><span class=\"line\">    &lt;<span class=\"regexp\">/block&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">  &lt;/</span>view&gt;</span><br><span class=\"line\">&lt;<span class=\"regexp\">/view&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p>CSS写的有点乱~大家可以自己写CSS,我是个不太喜欢CSS的人…感觉太难了,还是JS比较好。<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!-- WXSS --&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 日历面板  */</span></span><br><span class=\"line\">.calendar-panel &#123;</span><br><span class=\"line\">  font-size: <span class=\"number\">26</span>rpx;</span><br><span class=\"line\">  line-height: <span class=\"number\">72</span>rpx;</span><br><span class=\"line\">  padding-left: <span class=\"number\">24</span>rpx;</span><br><span class=\"line\">  padding-right: <span class=\"number\">24</span>rpx;</span><br><span class=\"line\">  display: flex;</span><br><span class=\"line\">  justify-content: space-between;</span><br><span class=\"line\">  align-items: center;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">.prevImg, .nextImg &#123;</span><br><span class=\"line\">  width: <span class=\"number\">40</span>rpx;</span><br><span class=\"line\">  height: <span class=\"number\">40</span>rpx;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">.prevImg &#123;</span><br><span class=\"line\">  transform: rotate(<span class=\"number\">180</span>deg);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">.calendar-panel image &#123;</span><br><span class=\"line\">  width: <span class=\"number\">40</span>rpx;</span><br><span class=\"line\">  height: <span class=\"number\">40</span>rpx;</span><br><span class=\"line\">  vertical-align: top;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">.calendar-header &#123;</span><br><span class=\"line\">  font-size: <span class=\"number\">28</span>rpx;</span><br><span class=\"line\">  line-height: <span class=\"number\">72</span>rpx;</span><br><span class=\"line\">  border-top: 2rpx solid #eee;</span><br><span class=\"line\">  border-bottom: 2rpx solid #eee;</span><br><span class=\"line\">  display: flex;</span><br><span class=\"line\">  justify-content: space-around;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">.calendar-header view &#123;</span><br><span class=\"line\">  width: <span class=\"number\">75</span>rpx;</span><br><span class=\"line\">  text-align: center;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">.calendar-body &#123;</span><br><span class=\"line\">  margin-top: <span class=\"number\">16</span>rpx;</span><br><span class=\"line\">  width: <span class=\"number\">100</span>%;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">.calender-body-date-week &#123;</span><br><span class=\"line\">  text-align: right;</span><br><span class=\"line\">  display: flex;</span><br><span class=\"line\">  justify-content: space-around;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">.date &#123;</span><br><span class=\"line\">  width: <span class=\"number\">75</span>rpx;</span><br><span class=\"line\">  height: <span class=\"number\">80</span>rpx;</span><br><span class=\"line\">  position: relative;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">.day&#123;</span><br><span class=\"line\">  width: <span class=\"number\">50</span>rpx;</span><br><span class=\"line\">  text-align: right;</span><br><span class=\"line\">  margin-left: <span class=\"number\">7</span>rpx;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">.stage &#123;</span><br><span class=\"line\">  width: <span class=\"number\">100</span>%;</span><br><span class=\"line\">  height: <span class=\"number\">100</span>%;</span><br><span class=\"line\">  font-size: <span class=\"number\">20</span>rpx;</span><br><span class=\"line\">  color: #38b2c0;</span><br><span class=\"line\">  box-sizing: border-box;</span><br><span class=\"line\">  padding-top: <span class=\"number\">65</span>%;</span><br><span class=\"line\">  text-align: center;</span><br><span class=\"line\">  position: absolute;</span><br><span class=\"line\">  top: <span class=\"number\">0</span>;</span><br><span class=\"line\">  left: <span class=\"number\">0</span>;</span><br><span class=\"line\">  bottom: <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 其他月份 样式  */</span></span><br><span class=\"line\"></span><br><span class=\"line\">.other-month &#123;</span><br><span class=\"line\">  color: #ccc;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* active Day  */</span></span><br><span class=\"line\"></span><br><span class=\"line\">.avtive-date &#123;</span><br><span class=\"line\">  color: #38b2c0;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>因为需求不一样,我的JS可能跟你的不一样,所以一般只需要 日历渲染函数、onLoad和改变月份这三个函数就够了。我已经在JS里写好了注释，可以很快的了解哪个函数是干什么的。<br>···JavaScript<br>    <!-- JS --></p>\n<pre><code>Page({\n  data: {\n    res: {},\n    moneyCalendar: [],\n    calendar: {\n      // 返回月份0 ~ 11\n      &apos;month&apos;: new Date().getMonth() + 1,\n      // 返回一个月中的某天 1~31\n      &apos;date&apos;: new Date().getDate(),\n      // 返回一周中的某一天 0 ~ 6\n      &quot;day&quot;: new Date().getDay(),\n      // 从 Date 对象以四位数字返回年份\n      &apos;year&apos;: new Date().getFullYear(),\n      // 渲染的数组\n      &quot;weeks&quot;: []\n    },\n    // 用于HTML里点击天时判断当前月,用month的话会改变month\n    active: &quot;&quot;\n  },\n  onLoad: function (options) {\n    var that = this\n\n    wx.request({\n      url: &apos;xxxxxxxxxxx&apos;,\n      success: function (res) {\n        that.setData({\n          res: res.data.data[&apos;产品团期&apos;]\n        })\n\n        var moneyCalendar = []\n        for (var i = 0, len = that.data.res.length; i &lt; len; i++) {\n          var starGroupTime = that.changeFormat(that.data.res[i].dep_date)\n          moneyCalendar.push(starGroupTime)\n          console.log(moneyCalendar)\n          that.setData({\n            moneyCalendar: moneyCalendar\n          })\n        }\n      }\n    })\n\n    // 页面初始化 options为页面跳转所带来的参数\n    var _date = new Date()\n    var year = _date.getFullYear()  //年\n    var month = _date.getMonth() + 1  //月\n    var date = _date.getDate()    //日\n\n    this.setData({\n      &quot;calendar.year&quot;: year,\n      &quot;calendar.month&quot;: month,\n      &quot;calendar.date&quot;: date,\n      active: month\n    })\n    this.calendarDrawing(year, month, date)\n  },\n  onReady: function () {\n    // 页面渲染完成\n  },\n  onShow: function () {\n    // 页面显示\n  },\n  onHide: function () {\n    // 页面隐藏\n  },\n  onUnload: function () {\n    // 页面关闭\n  },\n\n  // 改变时间格式\n  changeFormat: function (date) {\n    console.log(date)\n    var timeArr = date.split(&quot;-&quot;)\n    var year = timeArr[0]\n    var month = timeArr[1]\n    var date = timeArr[2]\n    return {\n      year: year,\n      month: month,\n      date: date\n    }\n  },\n\n  // 改变月份 按钮\n  changeMonth: function (e) {\n    console.log(this)\n    // 获取当前calendar里面的年月日\n    var year = this.data.calendar.year   //年\n    var month = this.data.calendar.month  //月\n    var date = this.data.calendar.date   //日\n\n    var target = e.target.dataset.name\n    // 判断点击目标 改变月份\n    if (target === &quot;prev&quot;) {\n      month = month - 1\n      if (month &lt; 1) {\n        month = 12\n        year = year - 1\n      }\n    } else if (target === &quot;next&quot;) {\n      month = month + 1\n      if (month &gt; 12) {\n        month = 1\n        year = year + 1\n      }\n    }\n    this.setData({\n      &quot;calendar.month&quot;: month\n    })\n    this.calendarDrawing(year, month, date)\n  },\n\n\n  // 选择 某天  按钮\n  selectDay: function (e) {\n    console.log(e)\n    // 点击的是哪一天\n    var targetDay = e.currentTarget.dataset.activeday.date\n    // 点击的天是哪个月的\n    var targetMonth = e.currentTarget.dataset.activeday.month\n\n    // console.log(targetDay)\n    this.setData({\n      &quot;calendar.date&quot;: targetDay,\n      active: targetMonth\n    })\n    console.log(this)\n  },\n\n\n  // 日历 渲染函数\n  calendarDrawing: function (year, month, date) {\n    var _date = new Date()\n\n    console.log(year + &quot;-&quot; + month + &quot;-&quot; + date)\n    var day = _date.getDay() // 周几 返回几就是周几, 0 是周日\n\n    // 这个月的第一天 是周几\n    var firstDay = new Date(year, month - 1, 1).getDay()\n    console.log(&apos;本月第一天是周 :&apos; + firstDay)\n\n    // 上个月在本月显示的天数的数组\n    var lastMonthDays = [];\n    for (var i = firstDay - 1; i &gt;= 0; i--) {\n      // 可以用 负的 天 来从本月算到上个月\n      console.log(new Date(year, month - 1, -i).getDate())\n\n      // 上个月的 天 倒序\n      lastMonthDays.push({\n        // 注意: 数组里面不只有天,还有月份,可以用月分可以判断样式,例如字体颜色\n        &apos;date&apos;: new Date(year, month - 1, -i).getDate(),\n        &apos;month&apos;: month - 1\n      })\n    }\n    // 本月 天数 数组\n    var currentMonthDays = [];\n    console.log(new Date(year, month, 0).getDate()) //判断天数(用下个月的0天 返回本月最后一天)\n    for (var i = 1, len = new Date(year, month, 0).getDate(); i &lt;= len; i++) {\n      currentMonthDays.push({\n        &apos;date&apos;: i,\n        &apos;month&apos;: month\n      })\n    }\n    // 下月 天数 数组\n    var nextMonthDays = []\n    var endDay = new Date(year, month, 0).getDay(); //判断本月最后一天星期几\n    console.log(&apos;本月 最后一天 星期几:&apos; + endDay)\n    for (var i = 1; i &lt; 7 - endDay; i++) {\n      nextMonthDays.push({\n        &apos;date&apos;: i,\n        &apos;month&apos;: month + 1\n      })\n    }\n\n    var calendar = []\n    calendar = calendar.concat(lastMonthDays, currentMonthDays, nextMonthDays)\n    var weeks = []\n\n    for (var i = 0; i &lt; calendar.length; i++) {\n      if (i % 7 == 0) {\n        // 7个一组 分开总数组\n        weeks[parseInt(i / 7)] = new Array(7);\n      }\n      // 用 parseInt来直接实现自动添加分组数据\n      weeks[parseInt(i / 7)][i % 7] = calendar[i]\n    }\n\n    console.log(weeks)\n    this.setData({\n      &quot;calendar.year&quot;: year,\n      &quot;calendar.month&quot;: month,\n      &quot;calendar.date&quot;: date,\n      &quot;calendar.weeks&quot;: weeks\n    })\n  }\n})\n</code></pre><p>···</p>\n","categories":[],"tags":[]}