{"total":15,"pageSize":4,"pageCount":4,"data":[{"title":"小程序支付-前端代码","slug":"小程序支付","date":"2018-03-25T11:32:08.000Z","updated":"2018-03-25T11:51:44.000Z","comments":true,"path":"api/articles/小程序支付.json","excerpt":"","keywords":null,"cover":null,"content":"<p>这里只有前端的代码，其实大部分支付流程都是后端写的，因为安全原因，很多东西是不放在前端的，所以前端的代码其实很简单。</p>\n<p>首先，要获取用户的openId，在这里为sid</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!-- app.js --&gt;</span><br><span class=\"line\">onLaunch: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 展示本地存储能力</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> logs = wx.getStorageSync(<span class=\"string\">'logs'</span>) || []</span><br><span class=\"line\">    logs.unshift(<span class=\"built_in\">Date</span>.now())</span><br><span class=\"line\">    wx.setStorageSync(<span class=\"string\">'logs'</span>, logs)</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.sid = wx.getStorageSync(<span class=\"string\">'sid'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 登录</span></span><br><span class=\"line\">    wx.login(&#123;</span><br><span class=\"line\">      success: <span class=\"function\"><span class=\"params\">res</span> =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 发送 res.code 到后台换取 openId, sessionKey, unionId</span></span><br><span class=\"line\">        <span class=\"keyword\">this</span>.post(</span><br><span class=\"line\">          <span class=\"string\">'api/WxPay/login'</span>,</span><br><span class=\"line\">          &#123; <span class=\"attr\">code</span>: res.code &#125;,</span><br><span class=\"line\">          data =&gt; &#123;</span><br><span class=\"line\">            wx.setStorageSync(<span class=\"string\">'sid'</span>, data.sid)</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.sid = data.sid</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        )</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>然后，需要写出请求的request函数。<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">host: <span class=\"string\">'https://xxx.xxx.cpm/xxxxxx/'</span>,</span><br><span class=\"line\">post: <span class=\"function\">(<span class=\"params\">url, data, cb</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    data = data || &#123;&#125;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> app = getApp();</span><br><span class=\"line\">    data.sid = app.sid;</span><br><span class=\"line\">    url = app.host + url;</span><br><span class=\"line\">    wx.request(&#123;</span><br><span class=\"line\">      url: url,</span><br><span class=\"line\">      data: data,</span><br><span class=\"line\">      method: <span class=\"string\">'POST'</span>,</span><br><span class=\"line\">      success: <span class=\"function\"><span class=\"params\">res</span> =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> data = res.data;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!data.success) &#123;</span><br><span class=\"line\">          wx.showModal(&#123;</span><br><span class=\"line\">            title: <span class=\"string\">'出错了'</span>,</span><br><span class=\"line\">            content: data.message,</span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">          cb(data.data)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      fail: <span class=\"function\"><span class=\"params\">res</span> =&gt;</span> &#123;</span><br><span class=\"line\">        wx.showModal(&#123;</span><br><span class=\"line\">          title: <span class=\"string\">'请求失败'</span>,</span><br><span class=\"line\">          content: <span class=\"built_in\">JSON</span>.stringify(res),</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>最后，支付的事件。<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!-- 支付事件触发 --&gt;</span><br><span class=\"line\">pay: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// order_id为订单唯一id 根据订单id支付金额</span></span><br><span class=\"line\">    getApp().post(<span class=\"string\">'xx/xxx/xxx'</span>, &#123; <span class=\"attr\">order_id</span>: roder_id &#125;, data =&gt; &#123;</span><br><span class=\"line\">      wx.requestPayment(&#123;</span><br><span class=\"line\">        <span class=\"string\">'timeStamp'</span>: data.timeStamp,</span><br><span class=\"line\">        <span class=\"string\">'nonceStr'</span>: data.nonceStr,</span><br><span class=\"line\">        <span class=\"string\">'package'</span>: data.package,</span><br><span class=\"line\">        <span class=\"string\">'signType'</span>: <span class=\"string\">'MD5'</span>,</span><br><span class=\"line\">        <span class=\"string\">'paySign'</span>: data.paySign,</span><br><span class=\"line\">        <span class=\"string\">'success'</span>: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">res</span>) </span>&#123;</span><br><span class=\"line\">          wx.showToast(&#123;</span><br><span class=\"line\">            title: <span class=\"string\">'支付成功'</span>,</span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">'fail'</span>: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">res</span>) </span>&#123;</span><br><span class=\"line\">          wx.showModal(&#123;</span><br><span class=\"line\">            title: <span class=\"string\">'支付失败'</span></span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>其实前端的代码真的不多，很多数据都是在后端处理的，放在前端的安全性不够。<br>前端代码就到这里，改天再放后端代码，哈哈</p>\n","text":"这里只有前端的代码，其实大部分支付流程都是后端写的，因为安全原因，很多东西是不放在前端的，所以前端的代码其实很简单。首先，要获取用户的openId，在这里为sid1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12","link":"","raw":null,"photos":[],"categories":[],"tags":[]},{"title":"小程序-日历","slug":"小程序-日历","date":"2018-03-11T06:18:11.000Z","updated":"2018-03-11T07:06:06.510Z","comments":true,"path":"api/articles/小程序-日历.json","excerpt":"","keywords":null,"cover":null,"content":"<p>最近开发小程序的时候,需要做一个日历,所以就自己开发了一个小程序日历控件。大家要是不想自己费时间来写的话，可以用这个。<br>(请注意,这个是不带一些节日的!因为我当时的需求不需要节日)</p>\n<p>不废话,直接上干货</p>\n<p>WXML可以去掉一些你不需要的东西,比如 WXS 就可以去掉,我是用它处理返回字符串格式的问题的。<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!-- WXML --&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;view <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">\"calendar\"</span> bindtap=<span class=\"string\">'tap'</span>&gt;</span><br><span class=\"line\">  &lt;view <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">\"calendar-panel\"</span> bindtap=<span class=\"string\">\"changeMonth\"</span>&gt;</span><br><span class=\"line\">    &lt;view <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">\"prevImg\"</span>&gt;</span><br><span class=\"line\">      &lt;image src=<span class=\"string\">\"../../images/icon/next.png\"</span> data-name=<span class=\"string\">\"prev\"</span> /&gt;</span><br><span class=\"line\">    &lt;<span class=\"regexp\">/view&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">    &lt;view class=\"time\"&gt;&#123;&#123;calendar.year&#125;&#125;年&#123;&#123;calendar.month&#125;&#125;月&#123;&#123;calendar.date&#125;&#125;日&lt;/</span>view&gt;</span><br><span class=\"line\">    &lt;view <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">\"nextImg\"</span>&gt;</span><br><span class=\"line\">      &lt;image src=<span class=\"string\">\"../../images/icon/next.png\"</span> data-name=<span class=\"string\">\"next\"</span> /&gt;</span><br><span class=\"line\">    &lt;<span class=\"regexp\">/view&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">  &lt;/</span>view&gt;</span><br><span class=\"line\">  &lt;view <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">\"calendar-header\"</span>&gt;</span><br><span class=\"line\">    &lt;view&gt;日&lt;<span class=\"regexp\">/view&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">    &lt;view&gt;一&lt;/</span>view&gt;</span><br><span class=\"line\">    &lt;view&gt;二&lt;<span class=\"regexp\">/view&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">    &lt;view&gt;三&lt;/</span>view&gt;</span><br><span class=\"line\">    &lt;view&gt;四&lt;<span class=\"regexp\">/view&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">    &lt;view&gt;五&lt;/</span>view&gt;</span><br><span class=\"line\">    &lt;view&gt;六&lt;<span class=\"regexp\">/view&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">  &lt;/</span>view&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">  &lt;wxs <span class=\"built_in\">module</span>=<span class=\"string\">\"split\"</span>&gt;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">split</span>(<span class=\"params\">data</span>)</span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> newData = data.split(<span class=\"string\">\".\"</span>)</span><br><span class=\"line\">      <span class=\"keyword\">return</span> newData[<span class=\"number\">0</span>]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">module</span>.exports.split = split</span><br><span class=\"line\">  &lt;<span class=\"regexp\">/wxs&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">  &lt;view class=\"calendar-body\"&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">    &lt;block wx:for=\"&#123;&#123;calendar.weeks&#125;&#125;\" wx:for-item=\"weeks\"&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">      &lt;view class=\"calender-body-date-week\"&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">        &lt;block wx:for=\"&#123;&#123;weeks&#125;&#125;\" wx:for-item=\"day\"&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">          &lt;view class=\"date &#123;&#123;calendar.month == day.month? '' : 'other-month'&#125;&#125; &#123;&#123;day.date==calendar.date &amp;&amp; day.month  == active ?'avtive-date': ''&#125;&#125;\"&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">            &lt;view class=\"day\"&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">              &#123;&#123;day.date&#125;&#125;</span></span><br><span class=\"line\"><span class=\"regexp\">            &lt;/</span>view&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">            &lt;view <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">\"stage\"</span> wx:<span class=\"keyword\">for</span>=<span class=\"string\">\"&#123;&#123; moneyCalendar &#125;&#125;\"</span> wx:<span class=\"keyword\">if</span>=<span class=\"string\">\"&#123;&#123;item.date == day.date &amp;&amp; item.month == day.month&#125; &#125;\"</span> bindtap=<span class=\"string\">\"selectDay\"</span> data-activeDay=<span class=\"string\">\"&#123;&#123;day&#125;&#125;\"</span> data-idn=<span class=\"string\">\"&#123;&#123;index&#125;&#125;\"</span>&gt;</span><br><span class=\"line\">               ￥&#123;&#123; split.split( res[index].peer_price) &#125;&#125; </span><br><span class=\"line\">            &lt;<span class=\"regexp\">/view&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">          &lt;/</span>view&gt;</span><br><span class=\"line\">        &lt;<span class=\"regexp\">/block&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">      &lt;/</span>view&gt;</span><br><span class=\"line\">    &lt;<span class=\"regexp\">/block&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">  &lt;/</span>view&gt;</span><br><span class=\"line\">&lt;<span class=\"regexp\">/view&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p>CSS写的有点乱~大家可以自己写CSS,我是个不太喜欢CSS的人…感觉太难了,还是JS比较好。<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!-- WXSS --&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 日历面板  */</span></span><br><span class=\"line\">.calendar-panel &#123;</span><br><span class=\"line\">  font-size: <span class=\"number\">26</span>rpx;</span><br><span class=\"line\">  line-height: <span class=\"number\">72</span>rpx;</span><br><span class=\"line\">  padding-left: <span class=\"number\">24</span>rpx;</span><br><span class=\"line\">  padding-right: <span class=\"number\">24</span>rpx;</span><br><span class=\"line\">  display: flex;</span><br><span class=\"line\">  justify-content: space-between;</span><br><span class=\"line\">  align-items: center;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">.prevImg, .nextImg &#123;</span><br><span class=\"line\">  width: <span class=\"number\">40</span>rpx;</span><br><span class=\"line\">  height: <span class=\"number\">40</span>rpx;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">.prevImg &#123;</span><br><span class=\"line\">  transform: rotate(<span class=\"number\">180</span>deg);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">.calendar-panel image &#123;</span><br><span class=\"line\">  width: <span class=\"number\">40</span>rpx;</span><br><span class=\"line\">  height: <span class=\"number\">40</span>rpx;</span><br><span class=\"line\">  vertical-align: top;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">.calendar-header &#123;</span><br><span class=\"line\">  font-size: <span class=\"number\">28</span>rpx;</span><br><span class=\"line\">  line-height: <span class=\"number\">72</span>rpx;</span><br><span class=\"line\">  border-top: 2rpx solid #eee;</span><br><span class=\"line\">  border-bottom: 2rpx solid #eee;</span><br><span class=\"line\">  display: flex;</span><br><span class=\"line\">  justify-content: space-around;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">.calendar-header view &#123;</span><br><span class=\"line\">  width: <span class=\"number\">75</span>rpx;</span><br><span class=\"line\">  text-align: center;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">.calendar-body &#123;</span><br><span class=\"line\">  margin-top: <span class=\"number\">16</span>rpx;</span><br><span class=\"line\">  width: <span class=\"number\">100</span>%;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">.calender-body-date-week &#123;</span><br><span class=\"line\">  text-align: right;</span><br><span class=\"line\">  display: flex;</span><br><span class=\"line\">  justify-content: space-around;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">.date &#123;</span><br><span class=\"line\">  width: <span class=\"number\">75</span>rpx;</span><br><span class=\"line\">  height: <span class=\"number\">80</span>rpx;</span><br><span class=\"line\">  position: relative;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">.day&#123;</span><br><span class=\"line\">  width: <span class=\"number\">50</span>rpx;</span><br><span class=\"line\">  text-align: right;</span><br><span class=\"line\">  margin-left: <span class=\"number\">7</span>rpx;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">.stage &#123;</span><br><span class=\"line\">  width: <span class=\"number\">100</span>%;</span><br><span class=\"line\">  height: <span class=\"number\">100</span>%;</span><br><span class=\"line\">  font-size: <span class=\"number\">20</span>rpx;</span><br><span class=\"line\">  color: #38b2c0;</span><br><span class=\"line\">  box-sizing: border-box;</span><br><span class=\"line\">  padding-top: <span class=\"number\">65</span>%;</span><br><span class=\"line\">  text-align: center;</span><br><span class=\"line\">  position: absolute;</span><br><span class=\"line\">  top: <span class=\"number\">0</span>;</span><br><span class=\"line\">  left: <span class=\"number\">0</span>;</span><br><span class=\"line\">  bottom: <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 其他月份 样式  */</span></span><br><span class=\"line\"></span><br><span class=\"line\">.other-month &#123;</span><br><span class=\"line\">  color: #ccc;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* active Day  */</span></span><br><span class=\"line\"></span><br><span class=\"line\">.avtive-date &#123;</span><br><span class=\"line\">  color: #38b2c0;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>因为需求不一样,我的JS可能跟你的不一样,所以一般只需要 日历渲染函数、onLoad和改变月份这三个函数就够了。我已经在JS里写好了注释，可以很快的了解哪个函数是干什么的。<br>···JavaScript<br>    <!-- JS --></p>\n<pre><code>Page({\n  data: {\n    res: {},\n    moneyCalendar: [],\n    calendar: {\n      // 返回月份0 ~ 11\n      &apos;month&apos;: new Date().getMonth() + 1,\n      // 返回一个月中的某天 1~31\n      &apos;date&apos;: new Date().getDate(),\n      // 返回一周中的某一天 0 ~ 6\n      &quot;day&quot;: new Date().getDay(),\n      // 从 Date 对象以四位数字返回年份\n      &apos;year&apos;: new Date().getFullYear(),\n      // 渲染的数组\n      &quot;weeks&quot;: []\n    },\n    // 用于HTML里点击天时判断当前月,用month的话会改变month\n    active: &quot;&quot;\n  },\n  onLoad: function (options) {\n    var that = this\n\n    wx.request({\n      url: &apos;xxxxxxxxxxx&apos;,\n      success: function (res) {\n        that.setData({\n          res: res.data.data[&apos;产品团期&apos;]\n        })\n\n        var moneyCalendar = []\n        for (var i = 0, len = that.data.res.length; i &lt; len; i++) {\n          var starGroupTime = that.changeFormat(that.data.res[i].dep_date)\n          moneyCalendar.push(starGroupTime)\n          console.log(moneyCalendar)\n          that.setData({\n            moneyCalendar: moneyCalendar\n          })\n        }\n      }\n    })\n\n    // 页面初始化 options为页面跳转所带来的参数\n    var _date = new Date()\n    var year = _date.getFullYear()  //年\n    var month = _date.getMonth() + 1  //月\n    var date = _date.getDate()    //日\n\n    this.setData({\n      &quot;calendar.year&quot;: year,\n      &quot;calendar.month&quot;: month,\n      &quot;calendar.date&quot;: date,\n      active: month\n    })\n    this.calendarDrawing(year, month, date)\n  },\n  onReady: function () {\n    // 页面渲染完成\n  },\n  onShow: function () {\n    // 页面显示\n  },\n  onHide: function () {\n    // 页面隐藏\n  },\n  onUnload: function () {\n    // 页面关闭\n  },\n\n  // 改变时间格式\n  changeFormat: function (date) {\n    console.log(date)\n    var timeArr = date.split(&quot;-&quot;)\n    var year = timeArr[0]\n    var month = timeArr[1]\n    var date = timeArr[2]\n    return {\n      year: year,\n      month: month,\n      date: date\n    }\n  },\n\n  // 改变月份 按钮\n  changeMonth: function (e) {\n    console.log(this)\n    // 获取当前calendar里面的年月日\n    var year = this.data.calendar.year   //年\n    var month = this.data.calendar.month  //月\n    var date = this.data.calendar.date   //日\n\n    var target = e.target.dataset.name\n    // 判断点击目标 改变月份\n    if (target === &quot;prev&quot;) {\n      month = month - 1\n      if (month &lt; 1) {\n        month = 12\n        year = year - 1\n      }\n    } else if (target === &quot;next&quot;) {\n      month = month + 1\n      if (month &gt; 12) {\n        month = 1\n        year = year + 1\n      }\n    }\n    this.setData({\n      &quot;calendar.month&quot;: month\n    })\n    this.calendarDrawing(year, month, date)\n  },\n\n\n  // 选择 某天  按钮\n  selectDay: function (e) {\n    console.log(e)\n    // 点击的是哪一天\n    var targetDay = e.currentTarget.dataset.activeday.date\n    // 点击的天是哪个月的\n    var targetMonth = e.currentTarget.dataset.activeday.month\n\n    // console.log(targetDay)\n    this.setData({\n      &quot;calendar.date&quot;: targetDay,\n      active: targetMonth\n    })\n    console.log(this)\n  },\n\n\n  // 日历 渲染函数\n  calendarDrawing: function (year, month, date) {\n    var _date = new Date()\n\n    console.log(year + &quot;-&quot; + month + &quot;-&quot; + date)\n    var day = _date.getDay() // 周几 返回几就是周几, 0 是周日\n\n    // 这个月的第一天 是周几\n    var firstDay = new Date(year, month - 1, 1).getDay()\n    console.log(&apos;本月第一天是周 :&apos; + firstDay)\n\n    // 上个月在本月显示的天数的数组\n    var lastMonthDays = [];\n    for (var i = firstDay - 1; i &gt;= 0; i--) {\n      // 可以用 负的 天 来从本月算到上个月\n      console.log(new Date(year, month - 1, -i).getDate())\n\n      // 上个月的 天 倒序\n      lastMonthDays.push({\n        // 注意: 数组里面不只有天,还有月份,可以用月分可以判断样式,例如字体颜色\n        &apos;date&apos;: new Date(year, month - 1, -i).getDate(),\n        &apos;month&apos;: month - 1\n      })\n    }\n    // 本月 天数 数组\n    var currentMonthDays = [];\n    console.log(new Date(year, month, 0).getDate()) //判断天数(用下个月的0天 返回本月最后一天)\n    for (var i = 1, len = new Date(year, month, 0).getDate(); i &lt;= len; i++) {\n      currentMonthDays.push({\n        &apos;date&apos;: i,\n        &apos;month&apos;: month\n      })\n    }\n    // 下月 天数 数组\n    var nextMonthDays = []\n    var endDay = new Date(year, month, 0).getDay(); //判断本月最后一天星期几\n    console.log(&apos;本月 最后一天 星期几:&apos; + endDay)\n    for (var i = 1; i &lt; 7 - endDay; i++) {\n      nextMonthDays.push({\n        &apos;date&apos;: i,\n        &apos;month&apos;: month + 1\n      })\n    }\n\n    var calendar = []\n    calendar = calendar.concat(lastMonthDays, currentMonthDays, nextMonthDays)\n    var weeks = []\n\n    for (var i = 0; i &lt; calendar.length; i++) {\n      if (i % 7 == 0) {\n        // 7个一组 分开总数组\n        weeks[parseInt(i / 7)] = new Array(7);\n      }\n      // 用 parseInt来直接实现自动添加分组数据\n      weeks[parseInt(i / 7)][i % 7] = calendar[i]\n    }\n\n    console.log(weeks)\n    this.setData({\n      &quot;calendar.year&quot;: year,\n      &quot;calendar.month&quot;: month,\n      &quot;calendar.date&quot;: date,\n      &quot;calendar.weeks&quot;: weeks\n    })\n  }\n})\n</code></pre><p>···</p>\n","text":"最近开发小程序的时候,需要做一个日历,所以就自己开发了一个小程序日历控件。大家要是不想自己费时间来写的话，可以用这个。<br>(请注意,这个是不带一些节日的!因为我当时的需求不需要节日)不废话,直接上干货WXML可以去掉一些你不需要的东西,比如 WXS 就可以去掉,我是用它处理返","link":"","raw":null,"photos":[],"categories":[],"tags":[]},{"title":"小程序 WXS语法","slug":"小程序-WXS语法","date":"2018-03-03T09:20:49.000Z","updated":"2018-03-03T12:18:06.429Z","comments":true,"path":"api/articles/小程序-WXS语法.json","excerpt":"<p><img src=\"https://github.com/shiyyyyy/images/raw/master/%E5%B0%8F%E7%A8%8B%E5%BA%8FWXS.jpg\" alt=\"img\"><br>因为最近一直在做小程序的项目，遇见了很多坑，其中就有在 WXML 中使用 Mustache 语法（双花括号）的问题，在 WXML 中的 双花括号语法里面是不能执行任何方法的，只可以做一些简单的四则运算和 Boolen 判断。也就是说是不可以用函数的！这对于一个使用 Vue 框架的人来说，是很残酷的。</p>\n<p><strong>例子：</strong></p>\n<p>页面渲染：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!--wxml--&gt; </span><br><span class=\"line\">&lt;view wx:for=&quot;&#123;&#123;[&apos;1&apos;， &apos;2&apos;， &apos;3&apos;]&#125;&#125;&quot;&gt;</span><br><span class=\"line\">    &#123;&#123; Number(item) &#125;&#125;</span><br><span class=\"line\">&lt;/view&gt;</span><br></pre></td></tr></table></figure></p>\n<p>页面输出：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> </span><br></pre></td></tr></table></figure></p>\n<p>这个是遍历不出来的，在模拟器里面什么都不会显示，因为 Mustache 语法不支持函数调用.是不是很残酷（´༎ຶД༎ຶ`）</p>","keywords":null,"cover":"https://github.com/shiyyyyy/images/raw/master/%E5%B0%8F%E7%A8%8B%E5%BA%8FWXS.jpg","content":null,"text":" [Figure] 每一个 WXS 模块，都需要用module标签进行命名。命名模块后，开发者工具才能正常进行编译、在 WXML 中引用模块中的变量与函数。另外，小程序的条件渲染和循环渲染对 WXS 是无效的也就是说，即使将 WXS 代码包裹在未渲染的代码中，只要渲染的 WXML","link":"","raw":null,"photos":[],"categories":[],"tags":[]},{"title":"小程序里的rpx、rem和px","slug":"小程序里的rpx、rem和px","date":"2018-02-03T10:56:34.000Z","updated":"2018-02-03T14:27:14.835Z","comments":true,"path":"api/articles/小程序里的rpx、rem和px.json","excerpt":"","keywords":null,"cover":null,"content":"<p>距写上一篇博客已经接近一个月了,因为这段时间比较忙,工作找到了,入职啊,熟悉代码之类的都挺费时间的。github也是已经很久没用了，因为新公司代码版本管理用的是SVN，哈哈哈。<br>正好在那要做小程序，就写一篇关于小程序rpx的博客。希望能够帮助到大家，也希望大家多多指教。</p>\n<h3 id=\"物理分辨率\"><a href=\"#物理分辨率\" class=\"headerlink\" title=\"物理分辨率\"></a>物理分辨率</h3><p>设备像素，在同一个设备上，它的物理分辨率是固定的，这是厂商在出厂时就设置好了的，即一个设备的分辨率是固定的。</p>\n<h3 id=\"逻辑分辨率\"><a href=\"#逻辑分辨率\" class=\"headerlink\" title=\"逻辑分辨率\"></a>逻辑分辨率</h3><p>CSS像素，viewport中的一个小方格，CSS样式代码中使用的是逻辑分辨率。如果在一个设备中，物理分辨率与逻辑分辨率相等，将不会产生任何问题。但是，在iphone 6中，物理分辨率是750<em>1334，而逻辑分辨率数为375 </em> 667。因此，需要使用大约4个物理像素来显示一个CSS像素。<br><strong>所以CSS的1px并不等于手机上的1像素。在不同物理分辨率的手机上显示CSS的1px需要的物理像素是不同的。</strong></p>\n<h3 id=\"px\"><a href=\"#px\" class=\"headerlink\" title=\"px\"></a>px</h3><p>px:像素 (计算机屏幕上的一个点)<br>这个大家都知道的，不需要多说什么。</p>\n<h3 id=\"rpx\"><a href=\"#rpx\" class=\"headerlink\" title=\"rpx\"></a>rpx</h3><p>尺寸单位<br>rpx（responsive pixel）: 可以根据屏幕宽度进行自适应。规定屏幕宽为750rpx。如在 iPhone6 上，屏幕宽度为375px，共有750个物理像素，则750rpx = 375px = 750物理像素，1rpx = 0.5px = 1物理像素。<br>|设备 | rpx换算px (屏幕宽度/750)    | px换算rpx (750/屏幕宽度)|<br>|- | :-: | -: |<br>|iPhone5        | 1rpx = 0.42px        | 1px = 2.34rpx|<br>|iPhone6        | 1rpx = 0.5px        | 1px = 2rpx|<br>|iPhone6 Plus   | 1rpx = 0.552px    | 1px = 1.81rpx|<br><strong>建议：</strong> 开发微信小程序时设计师可以用 iPhone6 作为视觉稿的标准。因为在 iPhone6 上，屏幕宽度为375px，共有750个物理像素，则750rpx = 375px = 750物理像素，1rpx = 0.5px = 1物理像素，这样会很方便，因为1rpx对应的就是1物理像素。</p>\n<p><strong>注意：</strong> 在较小的屏幕上不可避免的会有一些毛刺，请在开发时尽量避免这种情况。<br><strong>微信小程序也支持rem尺寸单位，rem和rpx的换算关系：rem: 规定屏幕宽度为20rem；1rem = (750/20)rpx</strong></p>\n<h3 id=\"rem\"><a href=\"#rem\" class=\"headerlink\" title=\"rem\"></a>rem</h3><p>相对长度单位。相对于根元素(即html元素)font-size计算值的倍数<br>比如html元素的font-size为20px，那么1rem就相当于20px。font-size为100px，那么1rem就相当于20px。<br>很好理解，不过使用rem需要注意的是不要和em混淆。（rem是相对于根元素html，而em则是相对于元素本身或者有font-size的父元素，有时间我会写一篇em和rem的博客的！）</p>\n<h3 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h3><p>我们在开发中的px与手机的物理像素并不是一比一的关系，应该是倍率的关系（是有1:1的时候的，不过随着现在屏幕分辨率越来越高，可以预见，基本上不会再出现1px与1物理像素1:1的时候了）。<br>同理rpx也不是与物理像素一比一的关系。微信团队将设备定义为750rpx，是以iPhone6的分辨率（750x1334）为基准划分的。</p>\n<p>到此为止，感谢您的阅读，敬请斧正。</p>\n","text":"距写上一篇博客已经接近一个月了,因为这段时间比较忙,工作找到了,入职啊,熟悉代码之类的都挺费时间的。github也是已经很久没用了，因为新公司代码版本管理用的是SVN，哈哈哈。<br>正好在那要做小程序，就写一篇关于小程序rpx的博客。希望能够帮助到大家，也希望大家多多指教。物理","link":"","raw":null,"photos":[],"categories":[],"tags":[]}]}